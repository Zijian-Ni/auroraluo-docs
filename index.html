<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <title>Aurora Luo</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- Docsify åŸºç¡€æ ·å¼ -->
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/docsify/themes/vue.css" />

    <!-- è‡ªå®šä¹‰æ ·å¼ï¼ˆåŒ…å«ï¼šå›ºå®šå³ä¸Šè§’ä¸»é¢˜æŒ‰é’®ã€é”šç‚¹åç§»ã€å›žåˆ°é¡¶éƒ¨ä½ç½®ä¿®å¤ã€æ¯›çŽ»ç’ƒç­‰ï¼‰ -->
    <link rel="stylesheet" href="custom.css" />
  </head>

  <body>
    <!-- Docsify å®¹å™¨ -->
    <div id="app">åŠ è½½ä¸­...</div>

    <!-- å³ä¸Šè§’ï¼šä¸»é¢˜åˆ‡æ¢æŒ‰é’®å®¹å™¨ï¼ˆè¢« CSS å›ºå®šåœ¨å³ä¸Šè§’ï¼‰ -->
    <div id="aurora-theme-toggle">
      <button id="theme-switch-btn" aria-label="åˆ‡æ¢ä¸»é¢˜">ðŸŒ“</button>
    </div>

    <!-- å›žåˆ°é¡¶éƒ¨æŒ‰é’®ï¼ˆä½ç½®åœ¨ CSS ä¸­è°ƒæ•´ï¼Œé¿å…è¢«é®æŒ¡ï¼‰ -->
    <button id="back-to-top" title="è¿”å›žé¡¶éƒ¨" aria-label="è¿”å›žé¡¶éƒ¨">â†‘</button>

    <!-- é˜…è¯»è¿›åº¦æ¡ï¼ˆè‹¥ä¸éœ€è¦å¯åˆ ï¼‰ -->
    <div id="reading-progress"></div>

    <!-- Docsify æ ¸å¿ƒè„šæœ¬ -->
    <script src="//cdn.jsdelivr.net/npm/docsify/lib/docsify.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/docsify/lib/plugins/search.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/docsify-copy-code/dist/docsify-copy-code.min.js"></script>

    <script>
      // =========================
      // Docsify é…ç½®ï¼ˆä¿æŒä½ çŽ°æœ‰åŸºçº¿ï¼Œå¹¶è¡¥ä¸Šé”šç‚¹ä¸Žè¡Œä¸ºï¼‰
      // =========================
      window.$docsify = {
        name: 'Aurora Luo',
        repo: '',
        loadSidebar: true,
        subMaxLevel: 2,
        auto2top: true,
        search: {
          paths: 'auto',
          placeholder: 'æœç´¢æ–‡æ¡£â€¦',
          noData: 'æœªæ‰¾åˆ°ç»“æžœ',
        },
        // ä¿æŒé”šç‚¹ï¼š#xxx
        routerMode: 'hash',

        // æ’ä»¶ï¼šé”šç‚¹åç§»å…œåº•ï¼ˆä¸Ž CSS çš„ scroll-margin-top æ­é…ï¼‰
        plugins: [
          function (hook, vm) {
            function getAnchorOffset() {
              const nav = document.querySelector('.app-nav');
              const navH = nav ? nav.getBoundingClientRect().height : 52;

              const bar =
                document.querySelector('#reading-progress') ||
                document.querySelector('.progress') ||
                document.querySelector('.progressbar');
              const barH = bar ? bar.getBoundingClientRect().height : 6;

              return Math.round(navH + barH + 10); // ä¸Ž custom.css ä¸­çš„ --anchor-offset å¯¹é½
            }

            function smartScrollFix() {
              if (!location.hash) return;
              const id = decodeURIComponent(location.hash);
              const el = document.querySelector(id);
              if (!el) return;

              // è®© docsify å…ˆæ»šï¼Œå†è¿›è¡Œåç§»ä¿®æ­£
              setTimeout(() => {
                const y = window.pageYOffset - getAnchorOffset();
                window.scrollTo({ top: y >= 0 ? y : 0, behavior: 'instant' });
              }, 0);
            }

            hook.doneEach(() => {
              smartScrollFix();
              // åˆå§‹åŒ–å›žåˆ°é¡¶éƒ¨æŒ‰é’®çš„æ˜¾ç¤º/éšè—
              handleBackToTopVisibility();
            });

            window.addEventListener('hashchange', smartScrollFix, false);
          },
        ],
      };

      // =========================
      // ä¸»é¢˜åˆ‡æ¢æŒ‰é’®ï¼šå›ºå®š + è§‚å¯Ÿä¿æŠ¤ï¼ˆé˜²æ­¢è¢« Docsify é‡ç»˜è¦†ç›–ï¼‰
      // =========================
      (function mountThemeSwitch() {
        const btn = document.getElementById('theme-switch-btn');

        // å½“å‰ä»…åœ¨â€œäº®/æš—â€åˆ‡æ¢ä¸Šåšæ¼”ç¤ºï¼Œå¦‚éœ€â€œè·Ÿéšç³»ç»Ÿâ€ç­‰ï¼Œå¯æ‰©å±•
        const THEME_KEY = 'aurora_theme';
        const root = document.documentElement;

        function applyTheme(theme) {
          if (theme === 'dark') {
            root.setAttribute('data-theme', 'dark');
            btn.textContent = 'ðŸŒž';
            btn.setAttribute('aria-label', 'åˆ‡æ¢åˆ°äº®è‰²ä¸»é¢˜');
          } else {
            root.removeAttribute('data-theme');
            btn.textContent = 'ðŸŒ“';
            btn.setAttribute('aria-label', 'åˆ‡æ¢åˆ°æš—è‰²ä¸»é¢˜');
          }
        }

        function getSavedTheme() {
          return localStorage.getItem(THEME_KEY) || 'light'; // ä½ çš„åŸºçº¿æ˜¯é»˜è®¤äº®è‰²
        }

        function toggleTheme() {
          const next = getSavedTheme() === 'dark' ? 'light' : 'dark';
          localStorage.setItem(THEME_KEY, next);
          applyTheme(next);
        }

        // åˆå§‹åº”ç”¨
        applyTheme(getSavedTheme());
        btn.addEventListener('click', toggleTheme);

        // MutationObserverï¼šå¦‚æžœ Docsify é‡ç»˜é¡¶éƒ¨å¯¼èˆªï¼Œä¸å½±å“è¿™ä¸ªå›ºå®šæŒ‰é’®
        const observer = new MutationObserver(() => {
          // è‹¥æŒ‰é’®è¢«å¤–éƒ¨æ ·å¼å½±å“ï¼Œå¯åœ¨è¿™é‡ŒäºŒæ¬¡æ ¡æ­£æ ·å¼æˆ–é‡æ–°æŒ‚è½½äº‹ä»¶
          applyTheme(getSavedTheme());
        });
        observer.observe(document.body, { childList: true, subtree: true });
      })();

      // =========================
      // é˜…è¯»è¿›åº¦æ¡ï¼ˆä½ åŸºçº¿å·²æœ‰ï¼Œè¿™é‡Œç»™ä¸€ä¸ªå¥å£®å®žçŽ°ï¼‰
      // =========================
      (function readingProgress() {
        const bar = document.getElementById('reading-progress');
        if (!bar) return;

        function update() {
          const article = document.querySelector('.content');
          if (!article) {
            bar.style.width = '0%';
            return;
          }
          const rect = article.getBoundingClientRect();
          const total = article.scrollHeight - window.innerHeight;
          const scrolled = window.scrollY - article.offsetTop;
          const pct = Math.max(0, Math.min(1, scrolled / Math.max(1, total)));
          bar.style.width = pct * 100 + '%';
        }

        window.addEventListener('scroll', update, { passive: true });
        window.addEventListener('resize', update);
        document.addEventListener('DOMContentLoaded', update);
      })();

      // =========================
      // å›žåˆ°é¡¶éƒ¨æŒ‰é’®ï¼ˆé¿å…è¢«é®æŒ¡ï¼Œä½ç½®å·²åœ¨ CSS è®©å‡ºç»™ä¸»é¢˜æŒ‰é’®ï¼‰
      // =========================
      (function backToTop() {
        const btn = document.getElementById('back-to-top');

        btn.addEventListener('click', () => {
          window.scrollTo({ top: 0, behavior: 'smooth' });
        });

        window.addEventListener('scroll', handleBackToTopVisibility, { passive: true });

        function handleBackToTopVisibility() {
          if (window.scrollY > 300) {
            btn.classList.add('show');
          } else {
            btn.classList.remove('show');
          }
        }
      })();
    </script>
  </body>
</html>
