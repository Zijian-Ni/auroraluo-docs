<!DOCTYPE html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, viewport-fit=cover">
    <meta name="color-scheme" content="light">
    <title>Aurora Luo · Wiki</title>
    <meta name="description" content="Aurora Luo - QQ 群智能助理：AI 对话、知识检索、Bilibili、百科、菜单卡片、HTTP 扩展等">
    <link rel="icon" href="data:,">
    <!-- Docsify + Themeable（多 CDN 兜底） -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsify@4/lib/themes/vue.css"
          onerror="this.onerror=null;this.href='https://unpkg.com/docsify@4/lib/themes/vue.css'">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/docsify-themeable/dist/css/theme-simple.css"
          onerror="this.onerror=null;this.href='https://unpkg.com/docsify-themeable/dist/css/theme-simple.css'">
    <!-- 自定义样式 -->
    <link rel="stylesheet" href="assets/css/custom.css?v=responsive-3">
  </head>
  <body>
    <!-- 顶部阅读进度条 -->
    <div id="reading-progress"></div>

    <!-- 返回顶部按钮 -->
    <button id="back-to-top" aria-label="返回顶部" title="回到顶部">↑</button>

    <!-- 右上角主题切换（固定，不依赖导航 DOM） -->
    <div id="aurora-theme-toggle">
      <button id="theme-switch-btn" aria-label="切换主题" title="切换明/暗">🌓</button>
    </div>

    <!-- Docsify 挂载点 -->
    <div id="app">加载中… Loading…</div>

    <!-- Docsify 配置 -->
    <script>
      window.$docsify = {
        name: 'Aurora Luo',
        repo: '',
        loadSidebar: true,
        loadNavbar: true,
        subMaxLevel: 3,
        auto2top: true,
        themeColor: '#7c4dff',
        formatUpdated: '{MM}/{DD} {HH}:{mm}',
        search: { paths: 'auto', placeholder: '搜索文档…', noData: '未找到结果', depth: 3 },
        pagination: { previousText: '上一页', nextText: '下一页', crossChapter: true, crossChapterText: true }
      };
    </script>

    <!-- Docsify 主体与插件（多 CDN 兜底） -->
    <script src="https://cdn.jsdelivr.net/npm/docsify@4"
            onerror="this.onerror=null;this.src='https://unpkg.com/docsify@4'"></script>
    <script src="https://cdn.jsdelivr.net/npm/docsify/lib/plugins/search.min.js"
            onerror="this.onerror=null;this.src='https://unpkg.com/docsify/lib/plugins/search.min.js'"></script>
    <script src="https://cdn.jsdelivr.net/npm/docsify/lib/plugins/zoom-image.min.js"
            onerror="this.onerror=null;this.src='https://unpkg.com/docsify/lib/plugins/zoom-image.min.js'"></script>
    <script src="https://cdn.jsdelivr.net/npm/docsify-copy-code/dist/docsify-copy-code.min.js"
            onerror="this.onerror=null;this.src='https://unpkg.com/docsify-copy-code/dist/docsify-copy-code.min.js'"></script>
    <script src="https://cdn.jsdelivr.net/npm/docsify-pagination/dist/docsify-pagination.min.js"
            onerror="this.onerror=null;this.src='https://unpkg.com/docsify-pagination/dist/docsify-pagination.min.js'"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-bash.min.js"
            onerror="this.onerror=null;this.src='https://unpkg.com/prismjs/components/prism-bash.min.js'"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-json.min.js"
            onerror="this.onerror=null;this.src='https://unpkg.com/prismjs/components/prism-json.min.js'"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-python.min.js"
            onerror="this.onerror=null;this.src='https://unpkg.com/prismjs/components/prism-python.min.js'"></script>
    <script src="https://cdn.jsdelivr.net/npm/prismjs/components/prism-ini.min.js"
            onerror="this.onerror=null;this.src='https://unpkg.com/prismjs/components/prism-ini.min.js'"></script>
    <script src="https://cdn.jsdelivr.net/npm/docsify-sidebar-collapse/dist/docsify-sidebar-collapse.min.js"
            onerror="this.onerror=null;this.src='https://unpkg.com/docsify-sidebar-collapse/dist/docsify-sidebar-collapse.min.js'"></script>
    <script src="https://cdn.jsdelivr.net/npm/docsify/lib/plugins/emoji.min.js"
            onerror="this.onerror=null;this.src='https://unpkg.com/docsify/lib/plugins/emoji.min.js'"></script>

    <!-- 交互增强：默认亮色、鲁棒锚点滚动、窄屏行为、滚动反馈 -->
    <script>
      (function () {
        /* ========== 主题：刷新恢复 light；会话内可切换 ========== */
        const root = document.documentElement;
        const applyTheme = t => root.setAttribute('data-theme', t);
        const toggleTheme = () => applyTheme(root.getAttribute('data-theme') === 'dark' ? 'light' : 'dark');
        applyTheme('light');
        document.getElementById('theme-switch-btn').addEventListener('click', toggleTheme);

        /* ========== 兜底创建 ========== */
        function ensureEl(id, tag) {
          let el = document.getElementById(id);
          if (!el) { el = document.createElement(tag); el.id = id; document.body.appendChild(el); }
          return el;
        }

        /* ========== 回到顶部 + 阅读进度 ========== */
        const backBtn = ensureEl('back-to-top', 'button');
        if (!backBtn.textContent) backBtn.textContent = '↑';
        backBtn.onclick = () => window.scrollTo({ top: 0, behavior: 'smooth' });
        const progress = ensureEl('reading-progress', 'div');
        const onScroll = () => {
          if (!progress || !progress.style) return;
          backBtn.classList.toggle('show', window.scrollY > 300);
          const st = document.documentElement.scrollTop || document.body.scrollTop || 0;
          const h  = (document.documentElement.scrollHeight - document.documentElement.clientHeight) || 1;
          progress.style.width = (st / h) * 100 + '%';
        };
        window.addEventListener('scroll', onScroll);
        document.addEventListener('DOMContentLoaded', onScroll);

        /* ========== 鲁棒锚点滚动（修复“左侧小点不跳转”） ========== */
        function esc(id) {
          try { return CSS.escape(id); } catch { return id; }
        }
        function findHeading(id) {
          if (!id) return null;
          // 1) 直接命中
          let el = document.getElementById(id) || document.querySelector('#' + esc(id));
          if (el) return el;
          // 2) 常见 slug 变体：小写、空格->连字符
          const alt = id.replace(/\s+/g, '-').toLowerCase();
          if (alt !== id) {
            el = document.getElementById(alt) || document.querySelector('#' + esc(alt));
            if (el) return el;
          }
          // 3) 点号被去除的情况（如“1.2 模式”）
          const noDot = alt.replace(/\./g, '');
          if (noDot !== alt) {
            el = document.getElementById(noDot) || document.querySelector('#' + esc(noDot));
            if (el) return el;
          }
          return null;
        }
        function scrollToId(id) {
          const el = findHeading(id);
          if (!el) return false;
          el.scrollIntoView({ block: 'start' });
          // 顶部预留偏移（避免被导航遮挡）
          window.scrollBy(0, -90);
          return true;
        }
        function getHashId() {
          const hash = decodeURIComponent(location.hash || '');
          const m = hash.match(/\?id=([^&]+)/);  // 兼容 #/page?id=xxx&xxx
          return m ? m[1] : null;
        }
        // 带重试（等待 Docsify 渲染完成）
        function scrollToHashRobust() {
          const id = getHashId();
          if (!id) return;
          let tries = 0;
          const tick = () => {
            if (scrollToId(id) || tries > 20) return;
            tries += 1;
            setTimeout(tick, 25);
          };
          tick();
        }

        /* ========== Docsify 生命周期：锚点 & 窄屏侧栏 ========== */
        window.$docsify = window.$docsify || {};
        const plugins = window.$docsify.plugins || [];
        plugins.push(function (hook, vm) {
          hook.ready(() => { if (window.innerWidth < 1300) document.body.classList.add('close'); });
          hook.doneEach(() => {
            scrollToHashRobust();   // 页面加载/切换后就位
            onScroll();
            // 窄屏：点击侧栏链接后自动收起
            const sb = document.querySelector('.sidebar');
            if (sb && window.innerWidth < 1300) {
              sb.querySelectorAll('a').forEach(a =>
                a.addEventListener('click', () => setTimeout(() => document.body.classList.add('close'), 60)));
            }
          });
        });
        window.$docsify.plugins = plugins;

        // 侧栏内小点点击：再触发一次定位（兼容第三方折叠插件）
        document.addEventListener('click', (e) => {
          const a = e.target.closest('.sidebar a[href*="?id="]');
          if (a) setTimeout(scrollToHashRobust, 0);
        });

        // hash 变化也定位
        window.addEventListener('hashchange', () => setTimeout(scrollToHashRobust, 0));

        /* ========== 简易失败提示 ========== */
        setTimeout(() => {
          const app = document.getElementById('app');
          if (app && app.textContent.includes('加载中')) {
            app.innerHTML = '⏳ 可能是 Pages 未启用或 CDN 受限。请确认根目录存在 <code>.nojekyll</code> 与 <code>_sidebar.md</code>。';
          }
        }, 3000);
      })();
    </script>
  </body>
</html>
