<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <title>Aurora Luo · Wiki</title>
    <meta name="description" content="Aurora Luo - QQ 群智能助理：AI 对话、知识检索、Bilibili、百科、菜单卡片、HTTP 扩展等">
    <link rel="icon" href="data:,">
    <!-- 主题（Docsify + Themeable） -->
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/docsify@4/lib/themes/vue.css">
    <link rel="stylesheet" href="//cdn.jsdelivr.net/npm/docsify-themeable/dist/css/theme-simple.css">
    <link rel="stylesheet" href="assets/css/custom.css">
  </head>
  <body>
    <!-- 顶部阅读进度条 -->
    <div id="reading-progress"></div>

    <!-- 返回顶部按钮 -->
    <button id="back-to-top" aria-label="返回顶部">↑</button>

    <!-- 暗黑模式切换按钮（注：也会插入到右上角导航） -->
    <button id="theme-toggle" aria-label="切换主题">🌓</button>

    <div id="app">加载中… Loading…</div>

    <script>
      // ===== Docsify 基础配置 =====
      window.$docsify = {
        name: 'Aurora Luo',
        repo: '',
        loadSidebar: true,
        loadNavbar: true,
        subMaxLevel: 3,              // 展示到三级小标题
        auto2top: true,
        themeColor: '#7c4dff',
        formatUpdated: '{MM}/{DD} {HH}:{mm}',
        search: { paths: 'auto', placeholder: '搜索文档…', noData: '未找到结果', depth: 3 },
        pagination: { previousText: '上一页', nextText: '下一页', crossChapter: true, crossChapterText: true }
      };
    </script>

    <!-- Docsify 核心 -->
    <script src="//cdn.jsdelivr.net/npm/docsify@4"></script>
    <!-- 常用插件 -->
    <script src="//cdn.jsdelivr.net/npm/docsify/lib/plugins/search.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/docsify/lib/plugins/zoom-image.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/docsify-copy-code/dist/docsify-copy-code.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/docsify-pagination/dist/docsify-pagination.min.js"></script>
    <!-- 语法高亮 -->
    <script src="//cdn.jsdelivr.net/npm/prismjs/components/prism-bash.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/prismjs/components/prism-json.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/prismjs/components/prism-python.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/prismjs/components/prism-ini.min.js"></script>
    <!-- 侧边栏折叠 + Emoji -->
    <script src="//cdn.jsdelivr.net/npm/docsify-sidebar-collapse/dist/docsify-sidebar-collapse.min.js"></script>
    <script src="//cdn.jsdelivr.net/npm/docsify/lib/plugins/emoji.min.js"></script>

    <!-- 交互增强脚本 -->
    <script>
      (function () {
        // ===== 主题（暗黑/明亮）切换 & 记忆 =====
        const root = document.documentElement;
        const LS_KEY = 'aurora-theme';
        function applyTheme(theme) {
          root.setAttribute('data-theme', theme);
          localStorage.setItem(LS_KEY, theme);
        }
        function initTheme() {
          const saved = localStorage.getItem(LS_KEY);
          if (saved) return applyTheme(saved);
          // 跟随系统
          const prefersDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
          applyTheme(prefersDark ? 'dark' : 'light');
        }
        function toggleTheme() {
          const now = root.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
          applyTheme(now);
        }
        initTheme();
        const themeBtn = document.getElementById('theme-toggle');
        themeBtn.addEventListener('click', toggleTheme);

        // 把主题按钮复制到右上角导航（app-nav）处，保持固定
        function mountThemeToggleToNav() {
          const nav = document.querySelector('.app-nav');
          if (!nav || nav.querySelector('.theme-toggle-clone')) return;
          const clone = themeBtn.cloneNode(true);
          clone.id = 'theme-toggle-nav';
          clone.classList.add('theme-toggle-clone');
          clone.addEventListener('click', toggleTheme);
          nav.appendChild(clone);
        }

        // ===== 侧栏交互：窄屏自动收起（无留白） =====
        const NARROW = () => window.innerWidth < 1300;
        function closeSidebarIfNarrow() { if (NARROW()) document.body.classList.add('close'); }
        function bindSidebarLinksAutoClose() {
          const sidebar = document.querySelector('.sidebar');
          if (!sidebar) return;
          sidebar.querySelectorAll('a').forEach(a => {
            a.addEventListener('click', () => setTimeout(closeSidebarIfNarrow, 60));
          });
        }

        // ===== 锚点滚动（小标题精准定位，兼容中文） =====
        function scrollToHashAnchor() {
          const hash = decodeURIComponent(location.hash || '');
          const m = hash.match(/\?id=(.+)$/);     // #/page?id=xxx
          if (!m) return;
          const id = m[1];
          let el = null;
          try {
            el = document.getElementById(id) || document.querySelector('[id="' + CSS.escape(id) + '"]');
          } catch (e) {
            el = document.getElementById(id);
          }
          if (el) {
            el.scrollIntoView({ block: 'start' });
            window.scrollBy(0, -90); // 顶部偏移，避免被吸顶遮挡
          }
        }

        // ===== 返回顶部按钮 & 阅读进度条 =====
        const backBtn = document.getElementById('back-to-top');
        const progress = document.getElementById('reading-progress');

        function onScrollFeedback() {
          // back-to-top 显示逻辑
          if (window.scrollY > 300) backBtn.classList.add('show');
          else backBtn.classList.remove('show');

          // 阅读进度
          const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
          const height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
          const percent = height > 0 ? (scrollTop / height) * 100 : 0;
          progress.style.width = percent + '%';
        }
        backBtn.addEventListener('click', () => window.scrollTo({ top: 0, behavior: 'smooth' }));

        // ===== Docsify 生命周期挂载 =====
        window.$docsify = window.$docsify || {};
        const plugins = window.$docsify.plugins || [];
        plugins.push(function (hook, vm) {
          hook.doneEach(function () {
            // 每次渲染完成：挂按钮、修锚点、侧栏收起
            mountThemeToggleToNav();
            scrollToHashAnchor();
            closeSidebarIfNarrow();
            bindSidebarLinksAutoClose();
            onScrollFeedback();
          });

          // 锚点变化 / 窗口尺寸变化
          window.addEventListener('hashchange', () => {
            setTimeout(scrollToHashAnchor, 0);
            setTimeout(closeSidebarIfNarrow, 0);
          });
          window.addEventListener('resize', () => {
            if (NARROW()) document.body.classList.add('close');
            else document.body.classList.remove('close');
          });
          window.addEventListener('scroll', onScrollFeedback);
        });
        window.$docsify.plugins = plugins;
      })();
    </script>
  </body>
</html>
